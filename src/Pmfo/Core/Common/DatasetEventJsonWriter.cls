/**********************************************************************
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR
OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE. 
***********************************************************************/

/*------------------------------------------------------------------------
    File        : DatasetEventJsonWriter
    Purpose     : 
    Syntax      : 
    Description : 
    Author(s)   : Havard Danielsen, Progress Software Corporation
    Created     : 2020
    Notes       : 
----------------------------------------------------------------------*/


block-level on error undo, throw.

using OpenEdge.Core.StringConstant from propath.
using Pmfo.Core.Common.DatasetProcessor from propath.
using Pmfo.Core.Common.DatasetParser from propath.

// expression that adds escape (backslash) to values that JSON convention is expecting to be escaped with backslash
// Note that backslash is escapped first so as to not replace all the other backslashes.  
&scop jsonescape  replace(replace(replace(replace(replace(replace(replace(replace(汨狎鲠祯妣堙荥堙┈郁蜷铉蔑铙翎铘郝撩爽茆З郁蜷铉蔑铙翎铘浩片苕З郁蜷铉蔑铙翎铘禾片茴З郁蜷铉蔑铙翎铘好椰茯З郁蜷铉蔑铙翎铘涸谅荇ЗНК墀ЗЫК芙З沆狍许骘蔑蝈蔑眄镱尼翎箦襞鲥铘鼠镱昨轸弪溴骈铄篝蝈犴牦镱骈戾溴骈铄瘐忪殂痱镳弪豉崎戾吾礤狍汨狎徙翦铒躅滹珏舢痱雉邈翦箦舢溴骈铄瘐忪殂痱镳弪豉契祆崎戾吾礤狍汨狎徙翦铒躅滹珏舁┖骈戾轭骘烘殪瀛钺礤崎戾吾礤蝈趱蝾骈戾轭骘烘蹯飙疳翳钺礤孱洚箦麸趄蹂麸镯黹溽翎箦黩狃疱ī溴骈铄瘐忪殂痱镳弪豉享黹裟狒狍弭狍祜玳汜铒躅滹珏舢箦舢泔铘蝻祗殒屙痿怩骀弪蟑汨殪怩骀弪箬秕熹忮箦獒扉邃溴驷蹯砸张ㄤ殒驽蝈铘骝镯黩轸瀛牦镱溴骈铄瘐忪殂痱镳弪豉渝蜷犰辁迮眇豉狍祜玳汜铒躅滹轭轸趄蹂珏舢箦舢泔眄箦疳蜥翦扉篝镦怩骀弪钺礤麸忮箦蜷犰辁邃狍镡赍泗犷铒狎蜥溴骈铄瘐忪殂痱镳弪豉娱铉蹯狎迈骀弪狍汨狎徙翦铒躅滹珏舢箦舢序镳弪糸弩翳狒趄徙篝狒徙蝻篌礤翳镤汜祆溴骈铄痱雉邈翦痱镳弪豉龄涿镯磲狍祜玳汜铒躅滹珏舢箦舢溴骈铄痱雉邈翦痱镳弪豉体鲥狍轭翦珏铒躅滹珏舢箦舢铒躞邃骘疱蜴矧磲钽蝈犸铙轸黠蹯忮汜祆邃滔溴骈铄痱雉邈翦痱镳弪豉涕铄酗狍轭翦珏铒躅滹珏舁┖蝈趱蝾体鲥伯孱洚泔铙趄蹉麸瘐忪殂尼翎箦襞鲥铘鼠镱昨轸弪ī篚疱ī孱泔铙趄蹉麸虍礤翳镤痱雉邈翦鲲殇龄湎怅邈羧遽溴颞疸吾礤狍汨狎徙翦┖殒龄涿镯磲翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博聃雉弪疸吾礤⒑郁蜷铉蔑铙翎铘好找藤呦信体鲥体鲥碑龄涿镯磲驷祗瀹孱礤翳镤礤翳镤痱雉邈翦鲲殇龄湎怅邈羧遽溴颞┖殒龄涿镯磲翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博郁蜷铉蔑铙翎铘好找藤呦信体鲥体鲥碑龄涿镯磲驷祗瀹孱礤翳镤礤翳镤痱雉邈翦鲲殇龄湎怅邈羝镲翦颞┖体鲥体鲥碑瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博郁蜷铉蔑铙翎铘好找藤呙滔优孱礤翳镤礤翳镤痱雉邈翦鲲殇龄淞蝌狴儒徜弪疸吾礤狍汨狎徙翦┖殒龄涿镯磲翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博聃雉弪疸吾礤⒑③体鲥体鲥碑龄涿镯磲驷祗瀹孱礤翳镤礤翳镤痱雉邈翦鲲殇龄淞蝌狴骑雉弪┖体鲥体鲥碑瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博⑤孱礤翳镤礤翳镤瘐忪殂鲲殇昨轸濞轭瘐痂尼翎箦狍栳钿戾轭瘐疸崎戾钺礤狍汨狎徙翦┖溴骈铄鲠蜷徕戾镄狎箦狍尼翎箦粜狎箦铒躅滹崎戾吾礤疸崎戾吾礤镄狎箦铄尼翎箦粜狎箦颞┊镄狎箦蚝嗅蝮迥狒狍弭痂尼翎箦舂镄狎箦蚝洛骘蝈崎蝮粢秣后踱筱蜷忮洛骘蝈崎蝮粢秣┊镄狎箦蚝伶翦蛱狍粢秣后踱筱蜷忮伶翦蛱狍粢秣┊镄狎箦蚝洛骘蝈绎骱篚怏泸殁濞洛骘蝈绎鳗镄狎箦蚝伶翦蛞秣后踱筱蜷忮伶翦蛞秣┊镄狎箦蚝彭痿绎骱篚怏泸殁濞彭痿绎鳗秕麴豸篝蝈犴牦镱骈戾麸鲠祯濞崎戾钺礤泔铞弪箫躜沐箦篌轱詈汨狎箦翎蜱弭⒄云涪铒磲铒邈栾殒享黹裟狒狍弭翳孱龄湎怅邈羧遽溴颞┊屐箦滹徜翳溽翎箦翳桢徜弪翳轶轶滹铄桢蝈麸黹黹翳麇轵黩轸瀛牦镱骘蝽狒糸铉鏖翳赭沲蜢镳孱镱翳筢礤扉铄铒牦镱蝈聃轵屙孱舂瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦郁蜷铉蔑铙翎铘好找藤呦信聃雉弪痂尼翎箦艉箦蜷犰辁瀛钺礤⒑郁蜷铉蔑铙翎铘好找藤呦信萎体鲥碑孱洚镄狎箦蚝嗅蝮迥狒狍弭痂尼翎箦舂龄湎怅邈羝镲翦颞┊翳溽翎箦孱铒溴轶徜溴镱翳筢礤扉铄狍麒狒弼弪铒溴麽黩轸翦麸忮泔铙轶翦铘鏖翳黩轸瀛牦镱铒牦镱蝈聃轵屙孱舂殒享黹裟狒狍弭驷祗翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦郁蜷铉蔑铙翎铘好找藤呙滔优骈钺祆秕麴豸篝蝈犴牦镱骈戾沆矬瀹溴戾翦镡赍泗镄狎箦虍孱骈钺祆孱礤翳镤礤翳镤瘐忪殂鲲殇洛骘蝈崎蝮粢秣轭瘐痂迈骀弪狍栳钿戾┖溴骈铄鲠蜷徕戾炝蝌狴狍祜玳汜铒躅滹炝蝌狴娱铉蹯狎迈骀弪矧祜镫躔痂怩骀弪侯犴瀣娱铉蹯狎迈骀弪螬爱殒炝蝌狴翳孱龄淞蝌狴儒徜弪痂迈骀弪后弪獒扉瀛钺礤┊孱礤翳镤礤翳镤瘐忪殂鲲殇伶翦蛱狍粢秣轭瘐痂迈骀弪狍栳钿戾┖溴骈铄鲠蜷徕戾炝蝌狴狍祜玳汜铒躅滹炝蝌狴娱铉蹯狎迈骀弪矧祜镫躔痂怩骀弪侯犴瀣娱铉蹯狎迈骀弪螬爱殒炝蝌狴翳孱龄淞蝌狴骑雉弪ī孱礤翳镤礤翳镤瘐忪殂鲲殇彭痿绎鳕轭瘐痂迈骀弪狍栳钿戾┖殒渝蜷犰辁迮眇豉翳孱滹殒娱铉蹯狎迈骀弪犷祜镫躔痂怩骀弪侯犴瀣娱铉蹯狎迈骀弪螬翳孱滹殒龄涿镯磲翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博聃雉弪痂怩骀弪后弪獒扉瀛钺礤⒑㈩蹯膦孱洚屐箦滹龄淞蝌狴儒徜弪痂迈骀弪后弪獒扉瀛钺礤┊龄淞蝌狴骑雉弪ī孱洚龄涿镯磲趄蹂孱洚孱礤翳镤栝溴骘蝈殓骈屐潴蝈趱蝾翳骈屐滂犷潇弩翳狒麇蝈栝滗孱澡轶轶黩轸翦轭北箫翳屮翦铘磲栳鲥铛祆鲠祯弩殒骈屐潴犰蝈徜狎栝滗孱礤翳镤痱雉邈翦栳钿戾屮翦铘乳溴骑蝈殓钇殄熹蟥痂义灬糸镱狍栳钿戾┖溴骈铄鲠蜷徕戾狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾闫殄熹狍汨狎徙翦铒躅滹溴骈铄鲠蜷徕戾杵殄熹狍栳钿戾铒躅滹溴骈铄鲠蜷徕戾枞殇溴狍栳钿戾屮翦铘铒躅滹溴骈铄鲠蜷徕戾槊秕铘狍轭翦珏铒躅滹屮翦铘ㄨ乳滗孱轭翦珏颞铛憝孱趄殄蟥痂义灬糸镱候屐狒轱瞽骈屐潴博滹麸铛憝孱趄殄蟥痂义灬糸镱候屐狒轱瞽骈屐潴怡埠闫殄熹孱趄ㄩ爆痂义灬糸镱候屐狒轱瞽骈屐潴┊杵殄熹痂义灬糸镱恒栝熹怩骀弪衡蹑驽颦骈屐洙闫殄熹┊殒杵殄熹后弪獒扉瀛栝滗孱驷祗翳孱滹槊秕铘槊秕铘碑枞殇溴钲槊秕铘杵殄熹杵殄熹后弪獒扉瀛栝滗孱趄蹂孱洚孱洚蝈趱蝾枞殇溴町孱礤翳镤礤翳镤瘐忪殂鲲殇洛骘蝈绎鳕轭瘐痂迈骀弪狍栳钿戾┖溴骈铄鲠蜷徕戾炝蝌狴狍祜玳汜铒躅滹炝蝌狴娱铉蹯狎迈骀弪矧祜镫躔痂怩骀弪侯犴瀣娱铉蹯狎迈骀弪螬爱殒炝蝌狴翳孱龄湎怅邈羧遽溴颞┊屐箦龄湎怅邈羧遽溴颞痂迈骀弪后弪獒扉瀛钺礤┊礤翳镤瘐忪殂鲲殇绎髌秕钿轭瘐痂迈骀弪狍栳钿戾┖溴骈铄鲠蜷徕戾槠熹狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾杵熹狍栳钿戾铒躅滹溴骈铄鲠蜷徕戾隳狒迤矧磲狍汨狎徙翦铒躅滹溴骈铄鲠蜷徕戾榕翦铘狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾槊镬郁狎狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾槊镬蓬狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾闾徕屐狍汨狎徙翦铒躅滹溴骈铄鲠蜷徕戾杵矧彘珙崎屐潴狍栳钿戾屮翦铘铒躅滹隳狒迤矧磲箦篌轱詈溽翦骘蝽狒箦篌轱詈溽翦骘蝽狒Ⅸ礓殒鲠扉洵栳钿戾痂迈骀弪吼狎孱舡蝈灬糸镱犷痂迈骀弪吼狎孱舡蝈灬糸镱侯弩翦犷痂迈骀弪吼狎孱舡蝈灬糸镱烘矧彘珙脲栝滗孱翳孱滹杵矧彘珙崎屐潴乳溴骑蝈殓钇殄熹蟥痂迈骀弪吼狎孱舡蝈灬糸镱┊孱洚滹槠熹麸痂迈骀弪侯蹴骈屐潴镱弪蝻躅滹翳蝻骱杵熹痂怩骀弪衡蹑驽颦骈屐洙槠熹┊殒杵熹后弪獒扉瀛栝滗孱驷祗翳孱滹殒桄熹哄翦铘翳孱滹龄淞蝌狴儒徜弪ㄨ骒浜箦蜷犰辁瀛钺礤┊狍箝珙闾徕屐槊镬郁狎槊镬蓬桄熹哄翦铘孱洚屐箦滹箦轸弪狒矧麸箫麇汜躞怩骀弪鲠祯濞癌犷翳躞豸殪辁翳筢礤泔溴骘屮翦铘犷铒瞽屮翦铘鲠蜷徕戾狍箝珙闾徕屐聃雉弪ㄨ旗浜箦蜷犰辁瀛钺礤⒑槊镬郁狎槊镬蓬孱洚龄泔眄麸痱弼扉铄殒狃痨殂徕戾龄涿镯磲轶驷祗麒孱序镢弩笃殄熹轶汜祆邃犷轶箦麸趄蹂徭翦翳骈蝮骈屐轶黩轸翦忮祜殒龄涿镯磲翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦滹榕翦铘槊镬郁狎麸槊镬蓬洚殒麇狎黩轸轭屮翦铘徜泔眄镱痱弼轱躞扉铄殒翳轶轶铒翳骈蝮屮翦铘殒榕翦铘翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦箅轲骈祆ㄓ趄轭缑镱篝犷艉羽徙瀣ㄌ弼屐博闾徕屐殒杵熹衡蹑驽颦鲠祯濞榕翦铘翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦㈩蹯膦屐箦滹汜箦杵熹轰狒岘豉疱麒孱汨狎徙翦颌翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦弩汜疱犰翳牦镱泔铞孱糸镱篝蹑筱镳汨狎鲠祯杵熹衡蹑驽颦鲠祯濞榕翦铘聃雉弪牦镱弩汜疱躅溴骈铄汨狎鲠祯麒孱沆镡矧麒孱⑩祜猗翳孱蔑瘗田庠锲殪濞杵熹┊麒孱㈤铘彗弪翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦杵熹衡蹑驽颦鲠祯濞榕翦铘麒孱溴汩磲膦翳孱滹瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦杵熹衡蹑驽颦鲠祯濞榕翦铘┊殒铒溴汩磲祗徜麸忮泔铙轶翦铘鏖翳黩轸瀛牦镱殒杵熹衡蹑驽颦鲠祯濞榕翦铘轭舁杵熹衡蹑驽颦鲠祯濞榕翦铘┅翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦阿孱洚麒孱溽翦矧麒孱溽翦糸礤矧麒孱溽翦糸礤酊翳孱轶溽翦瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦聃雉弪ㄩ箫溽翦ㄨ旗浜怩骀弪鲠祯濞榕翦铘┅┊麒孱㈧镧殂犰翳孱瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦殒杵熹衡蹑驽颦鲠祯濞榕翦铘趄蹂翳孱Ⅳ蝓澧屐箦㈡犰箦孱洚孱洚孱洚殒桄熹哄翦铘翳孱龄淞蝌狴骑雉弪ī箦麸趄蹂骘翳铄骈屐轭翳轶礤翳镤狍麇祆狍翳铄蝻矧铄狎蜥龄涿镯磲趄蹂孱洚孱洚轭翳躅扉脲禊汜箦翳狒犰骈屐潴狎栝滗孱龄涿镯磲趄蹂骈钺祆箦篌轱詈溽翦骘蝽狒隳狒迤矧磲舢滹槠熹麸屮翦铘ㄨ骑蝈殓钇殄熹螬殒鲠扉洵栳钿戾ㄨ骑蝈殓钇殄熹筵槠熹荸翳孱杵熹后弪獒扉瀛栝滗孱驷祗瀹孱洚孱洚孱礤翳镤礤翳镤瘐忪殂鲲殇伶翦蛞秣轭瘐痂迈骀弪狍栳钿戾┖龄湎怅邈羝镲翦颞┊孱礤翳镤礤翳镤痱雉邈翦鲲殇蔑瘗田庠锲殪濞痂骒狍栳钿戾┖溴骈铄鲠蜷徕戾闾镱狍祜铉汨狎铒躅滹溴骈铄鲠蜷徕戾硗屙狍礤眇趄铒躅滹殒痂骒浜溽翎豉疱沆镡翳孱泔瘗祜痂旗浜怩骀弪鲠祯麸闾镱绠屐箦殒痂骒浜溽翎豉疱⑩祜猗翳孱滹泔瘗祜痂旗浜怩骀弪鲠祯麸眄屙闾镱忉箦洞孱泔溴硗屙┊箦舡箝濞硗屙爱孱洚筱镳汨狎鲠祯闾镱闾镱牦镱弩汜疱弩汜疱犰翳牦镱泔铞孱糸镱篝蹑躅溴骈铄汨狎鲠祯黠螂狎秕钿北樊扉黹翎糸镱聃雉弪滹弩铒篚痧矧祜铉汨狎瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦БМ秕麴豸篝蝈犴牦镱骈戾沆矬瀹泔瘗祜闾镱麸骈戾契祆崎戾吾礤狃疱钿泔铞弪翎蜱弭泔溴疳珏⒄云涪秕麴豸篝蝈犴牦镱骈戾麸鲠祯濞崎戾钺礤泔铞弪箫躜沐箦篌轱詈汨狎箦翎蜱弭⒄云涪铒磲铒邈栾狃疱钿黠螂狎秕钿北樊扉黹翎糸镱聃雉弪滹弩铒篚痧矧祜铉汨狎瘐篝蝈犴鼠镱崎戾躅骘蝽狒翦БМ孱礤翳镤孱沆狍螽